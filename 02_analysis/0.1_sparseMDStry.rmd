---
title: "2_single_parcel_MDS"
author: "Ju-Chi.Yu"
date: "12/3/2021"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r cars, echo = FALSE, include = FALSE}
suppressMessages(library(psych))
suppressMessages(library(DistatisR)) # 
suppressMessages(library(tidyr))
suppressMessages(library(magrittr))
suppressMessages(library(data4PCCAR))
suppressMessages(library(PTCA4CATA))
suppressMessages(library(ggplot2))
suppressMessages(library(ExPosition))
suppressMessages(library(InPosition))
suppressMessages(library(superheat))
suppressMessages(library(gridExtra))
suppressMessages(library(ggplotify))
suppressMessages(library(grid))
suppressMessages(library(viridis))
suppressMessages(library(pals))
library(sGSVD)
library(SPAFAC)
# Read functions
tool.path <- "functions/"
source(paste0(tool.path, "PlotFactor.R"))
source(paste0(tool.path, "createLabel.gen.digit.R"))
source(paste0(tool.path, "createxyLabels.gen.digit.R"))

## load data
# load("../01_data/sub-MSCall9_zcube_rcube_DC.Rdata")
# load("../01_data/sub-MSCall9_zcube_rcube.Rdata")
# load("../01_data/indiv_parcel_info.rds")

data("blindSortingWines")

```

## Show heatmaps

![](../des_MSC/Display_Matrix_IndividualParc_files/figure-gfm/plot_all_sub_session_hmap-1.png)

## Run MDS on each individuals

```{r, include = FALSE}
## run MDS
mds.res <- epMDS(blindSortingWines$distance.Experts, graphs = FALSE)
PlotScree(mds.res$ExPosition.Data$eigs)

```



### Factor scores

```{r}
f.sub1 <- createFactorMap(
             mds.res$ExPosition.Data$fi,
             design = blindSortingWines$wineInformation$color,
             col.points = blindSortingWines$wineInformation$colorCode,
             col.labels = blindSortingWines$wineInformation$colorCode)


## get plots
f.sub1$zeMap

```

## sparse MDS

```{r}
dismat <- blindSortingWines$distance.Expert
MW <- MW <- computeMW(dismat)
dismat.proc <- mdsTransform(dismat, MW$M)
I <- nrow(dismat.proc)

grp <- blindSortingWines$wineInformation$color
rds <- rep(0.4*sqrt(I), 3)

sMDS.eigen <- sparseEIGEN(dismat.proc, W = MW$M, k = 3L, rds = rds, init = "svd")

sMDS.rv <- sprseEIGEN()
```

```{r}
fmat <- sMDS.eigen$vectors %*% diag(sqrt(sMDS.eigen$values))
rownames(fmat) <- rownames(dismat)
fig <- createFactorMap(fmat,col.point = blindSortingWines$wineInformation$colorCode,
                       col.labels = blindSortingWines$wineInformation$colorCode)
fig$zeMap

fig23 <- createFactorMap(fmat,col.point = blindSortingWines$wineInformation$colorCode,
                       axis1 = 3, axis2 = 2,
                       col.labels = blindSortingWines$wineInformation$colorCode)
fig23$zeMap

```

